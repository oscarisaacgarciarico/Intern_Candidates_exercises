<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Choose a Pokémon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://unpkg.com/modern-normalize@2.0.0/modern-normalize.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="home">
  <div class="home-wrap">
    <h1 class="home-title">Choose a Pokémon</h1>

    <div class="home-grid poke-grid">
      {% for name in pokemon_list %}
        <a class="poke-card" href="{{ url_for('pokemon', name=name) }}">
          <div class="poke-thumb-wrap">
            <img
              class="poke-thumb pixelated"
              data-pokename="{{ name }}"
              alt="{{ name|capitalize }}"
              width="112" height="112"
              loading="lazy">
          </div>
          <div class="poke-name">{{ name|capitalize }}</div>
        </a>
      {% endfor %}
    </div>
  </div>

  <script>
    const TYPE_COLORS = {
      normal:'#A8A77A', fire:'#EE8130', water:'#6390F0', electric:'#F7D02C',
      grass:'#7AC74C', ice:'#96D9D6', fighting:'#C22E28', poison:'#A33EA1',
      ground:'#E2BF65', flying:'#A98FF3', psychic:'#F95587', bug:'#A6B91A',
      rock:'#B6A136', ghost:'#735797', dragon:'#6F35FC', dark:'#705746',
      steel:'#B7B7CE', fairy:'#D685AD'
    };
    const textColorFor = (hex) => {
      const m = /^#([0-9a-f]{6})$/i.exec(hex||''); if(!m) return '#111';
      const r = parseInt(m[1].slice(0,2),16)/255,
            g = parseInt(m[1].slice(2,4),16)/255,
            b = parseInt(m[1].slice(4,6),16)/255;
      const lum = 0.2126*r + 0.7152*g + 0.0722*b;
      return lum > 0.6 ? '#111' : '#fff';
    };

    (async () => {
      const cards = Array.from(document.querySelectorAll('.poke-card'));
      await Promise.all(cards.map(async (card) => {
        const img = card.querySelector('img[data-pokename]');
        const name = img.dataset.pokename;
        try {
          const r = await fetch(`https://pokeapi.co/api/v2/pokemon/${name}`);
          if(!r.ok) return;
          const d = await r.json();

          const anim = d?.sprites?.versions?.['generation-v']?.['black-white']?.animated?.front_default;
          const stat = d?.sprites?.front_default;
          const art  = d?.sprites?.other?.['official-artwork']?.front_default;
          img.src = anim || stat || art || '';

          const t = d?.types?.[0]?.type?.name;
          const bg = TYPE_COLORS[t] || '#ffe45f';
          const nameEl = card.querySelector('.poke-name');
          nameEl.style.background = bg;
          nameEl.style.color = textColorFor(bg);
          nameEl.style.borderColor = 'rgba(0,0,0,.35)'; 
        } catch(e) {
          console.warn('PokeAPI error for', name, e);
        }
      }));
    })();
  </script>
</body>
</html>
